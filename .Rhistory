set.seed(1234)
id = c(1:50)
idlong = id%x%rep(1,5)
beta0=1
beta1=2
x = rnorm(250)
theta = rnorm(50,sd = sqrt(2))
thetalong=theta%x%rep(1,5)
y = beta0+beta1*x+thetalong+rnorm(250,mean=0,sd=sqrt(2))
simdata = data.frame(y,x,idlong)
simdata
rep(1,5)
id
idlong
thetalong
simdata
fit = lmer(y~x)
library(lmer4)
library(lmerTest)
fit = lmer(y~x)
fit = lmer(y~x+(1|id))
thetalong
library(lmerTest)
fit = lmer(y~x+91|idlong)
fit = lmer(y~x+(1|idlong),data = simdata)
summary(fit)
fit = lmer(y~x+(1|idlong),data = simdata)
summary(fit)
ICC= 1.566/(1.566+2.202)
ICC
ICC
library(mgcv)
fit_gam = gam(y~s(x)+(1|as.factor(idlong)),data = simdata)
as.factor(idlong)
fit_gam = gam(y~s(x)+s(as.factor(idlong),bs='re'),method = 'REML',data = simdata)
summary(fit_gam)
fit_gam = gam(y~s(x)+s(as.factor(idlong)),data = simdata)
fit_gam = gam(y~s(x)+s(as.factor(idlong),bs='re'),method ='RENL',data = simdata)
fit_gam = gam(y~s(x)+s(as.factor(idlong),bs='re'),method ='RENL',data = simdata)
fit_gam = gam(y~s(x)+s(as.factor(idlong),bs='re'),method ='REML',data = simdata)
summary(fit_gam)
fit = lmer(y~x+(1|idlong),data = simdata)
summary(fit)
ICC= 1.566/(1.566+2.202)
ICC
fit_gam = gam(y~s(x)+s(as.factor(idlong),bs='re'),method ='GCV',data = simdata)
fit_gam = gam(y~s(x)+s(as.factor(idlong),bs='re'),method ='GCV',data = simdata)
fit_gam = gam(y~s(x)+s(as.factor(idlong),bs='re'),method ='REML',data = simdata)
summary(fit_gam)
plot(fit_gam)
fit_gam = gam(y~s(x)+s(as.factor(idlong),bs='re'),method ='REML',data = simdata)
summary(fit_gam)
fit_gam = gam(y~s(x)+s(as.factor(idlong)),method ='REML',data = simdata)
fit_gam = gam(y~s(x)+s(as.factor(idlong),bs='re'),method ='REML',data = simdata)
summary(fit_gam)
fit_gam = gam(y~s(x)+s((1|as.factor(idlong)),bs='re'),method ='REML',data = simdata)
fit_gam = gam(y~s(x)+s(as.factor(idlong),bs='re'),method ='REML',data = simdata)
summary(fit_gam)
plot(fit_gam)
library(itsadug)
install.packages("itsadug")
library(itsadug)
plot_smooth(fit_gam)
plot_smooth
plot_smooth(fit_gam,x,rm.ranef = FALSE)
library(itsadug)
plot_smooth(fit_gam,view = x,rm.ranef = FALSE)
infant = read.csv('infant_trajectories.csv',header = TRUE)
fit.infant <- lmer(WB_fa.combat~Corr_age+factor(Sex)+(1|Unique_ID),data = infant)
summary(fit.infant)
#fitted vs. residual plots
plot(fit.infant , type = c("p", "smooth"))
fit_infant_gam = gam(WB_fa.combat~s(Corr_age)+sex+s(Unique_ID,bs ='re'),method = 'REML', data  = infant)
newd <- simdata[10,]
simdata$x[10]
newd$x <- simdata$x[10]-10(-5)
newd$x <- simdata$x[10]-10^(-5)
newd$x <- simdata$x[10]+10^(-5)
y2 <- predict(fit_gam,newd)
(y2-y1)/2*10^(-5)
newd <- simdata[10,]
newd$x <- simdata$x[10]-10^(-5)
y1 <- predict(fit_gam,newd)
newd$x <- simdata$x[10]+10^(-5)
y2 <- predict(fit_gam,newd)
(y2-y1)/2*10^(-5)
infant
fit_infant_gam = gam(WB_fa.combat~s(Corr_age)+Sex+s(Unique_ID,bs ='re'),method = 'REML', data  = infant)
fit_infant_gam = gam(WB_fa.combat~s(Corr_age)+s(Sex)+s(Unique_ID,bs ='re'),method = 'REML', data  = infant)
infant
infant
fit_infant_gam = gam(WB_fa.combat~s(Corr_age)+Sex+s(Unique_ID,bs ='re'),method = 'REML', data  = infant)
setwd("D:/homework and notes 2022 fall/toolkit/Final_Project")
renv::init()
renv::snapshot()
make install
fit_gam = gam(y~s(x)+s(as.factor(idlong),bs='re'),data = simdata)
summary(fit_gam)
newd <- simdata[10,]
newd$x <- simdata$x[10]-10^(-5)
y1 <- predict(fit_gam,newd)
newd$x <- simdata$x[10]+10^(-5)
y2 <- predict(fit_gam,newd)
(y2-y1)/2*10^(-5)
newd$x <- simdata$x[10]-1e-05
newd <- simdata[10,]
newd$x <- simdata$x[10]-1e-05
y1 <- predict(fit_gam,newd)
newd$x <- simdata$x[10]+1e-05
y2 <- predict(fit_gam,newd)
(y2-y1)/2*10^(-5)
newd <- simdata[10,]
newd$x <- simdata$x[10]-1e-05
y1 <- predict(fit_gam,newd)
newd$x <- simdata$x[10]+1e-05
y2 <- predict(fit_gam,newd)
(y2-y1)/2*1e-05
simdata$x[10]
newd <- simdata[10,]
newd$x <- simdata$x[10]-1e-05
y1 <- predict(fit_gam,newd)
newd$x <- simdata$x[10]+1e-05
y2 <- predict(fit_gam,newd)
(y2-y1)/2*1e-05
(y2-y1)/2e-05
newd <- simdata[10,]
newd$x <- simdata$x[10]-1e-05
y1 <- predict(fit_gam,newd)
newd$x <- simdata$x[10]+1e-05
y2 <- predict(fit_gam,newd)
(y2-y1)/2e-05
plot(fit_gam)
library(itsadug)
plot_smooth(fit_gam,view = "x",rm.ranef = FALSE)
library(itsadug)
plot_smooth(fit_gam,view = "x")
fit_gam = gam(y~s(x)+s(as.factor(idlong),bs='re'),data = simdata)
summary(fit_gam)
library(itsadug)
plot_smooth(fit_gam,view = "x")
library(itsadug)
plot_smooth(fit_gam,view = "x",rm.ranef = FALSE)
plot_smooth(fit_gam,view = "x",rm.ranef = TRUE)
library(itsadug)
plot_smooth(fit_gam,view = "x")
fit_gamnew = gam(y~s(x)+s(as.factor(idlong),bs='re'),data = simdata)
summary(fit_gamnew)
set.seed(1234)
id = c(1:50)
idlong = id%x%rep(1,5)
beta0=1
beta1=2
x = rnorm(250)
theta = rnorm(50,sd = sqrt(2))
thetalong=theta%x%rep(1,5)
y = beta0+beta1*x+thetalong+rnorm(250,mean=0,sd=sqrt(8))
simdata = data.frame(y,x,idlong)
fit_gamnew = gam(y~s(x)+s(as.factor(idlong),bs='re'),data = simdata)
summary(fit_gamnew)
infant = read.csv('infant_trajectories.csv',header = TRUE)
fit.infant <- lmer(WB_fa.combat~Corr_age+factor(Sex)+(1|Unique_ID),data = infant)
summary(fit.infant)
fit_infant_gam = gam(WB_fa.combat~s(Corr_age)+Sex+s(Unique_ID,bs ='re'),method = 'REML', data  = infant)
fit_infant_gam = gam(WB_fa.combat~s(Corr_age+Sex)+s(Unique_ID,bs ='re'), data  = infant)
fit_infant_gam = gam(WB_fa.combat~s(Corr_age+Sex)+s(Unique_ID,bs ='re'),data  = infant)
